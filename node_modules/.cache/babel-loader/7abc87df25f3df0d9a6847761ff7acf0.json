{"ast":null,"code":"import _defineProperty from\"/Users/apple/Dropbox/My Mac (zaytsev.local)/Documents/mapbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/apple/Dropbox/My Mac (zaytsev.local)/Documents/mapbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/apple/Dropbox/My Mac (zaytsev.local)/Documents/mapbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/apple/Dropbox/My Mac (zaytsev.local)/Documents/mapbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/apple/Dropbox/My Mac (zaytsev.local)/Documents/mapbox/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import ReactMapGL,{Marker,Popup}from'react-map-gl';import{BrowserRouter as Router,Switch,Route,Link,useParams}from\"react-router-dom\";import ImageView from'./components/ImageView';import AddBox from'./components/AddBox';import User from'./components/User';import Processing from'./components/Processing';import Direction from'./components/Direction';import Clock from'./components/Clock';import{connect}from'react-redux';import{userLogin,userLogout}from'./actions/userActions';var Mapbox=function Mapbox(props){var _useParams=useParams(),id=_useParams.id;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),logEntries=_useState2[0],setLogEntries=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),showPopup=_useState4[0],setShowPopup=_useState4[1];var _useState5=useState(id?parseInt(id):0),_useState6=_slicedToArray(_useState5,2),isShown=_useState6[0],setShow=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isAdd=_useState8[0],setAdd=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),point=_useState10[0],setPoint=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),pos=_useState12[0],setPos=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),user=_useState14[0],setUser=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),load=_useState16[0],setLoad=_useState16[1];var _useState17=useState({}),_useState18=_slicedToArray(_useState17,2),logged=_useState18[0],setLogged=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),hint=_useState20[0],setHint=_useState20[1];var _useState21=useState({width:'100vw',height:'100vh',latitude:10.7781128,longitude:106.65325,zoom:12}),_useState22=_slicedToArray(_useState21,2),viewport=_useState22[0],setViewport=_useState22[1];var getLocation=function getLocation(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition);}else{alert(\"Geolocation is not supported by this browser.\");}};var showPosition=function showPosition(position){setViewport({width:'100vw',height:'100vh',latitude:position.coords.latitude,longitude:position.coords.longitude,zoom:12});};var getUser=function getUser(){console.log(\"in getUser()\");fetch(\"http://localhost:3000/auth/login/success\",{method:\"GET\",credentials:\"include\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Access-Control-Allow-Credentials\":true}}).then(function(response){console.log(\"in then1\");getEntries();if(response.status===200)return response.json();throw new Error(\"failed to authenticate user\");}).then(function(responseJson){setLogged(responseJson.user);setUser(true);}).catch(function(error){setLogged(false);});};var getEntries=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch('http://localhost:3000/api/logs');case 2:response=_context.sent;_context.next=5;return response.json();case 5:result=_context.sent;// setLogEntries(result)\nconsole.log(result);setLogEntries(result);setLoad(true);//setUser(result)\ncase 9:case\"end\":return _context.stop();}}},_callee);}));return function getEntries(){return _ref.apply(this,arguments);};}();useEffect(function(){if(window.location.hash===\"#_=_\"){window.history.replaceState?window.history.replaceState(null,null,window.location.href.split(\"#\")[0]):window.location.hash=\"\";}getUser();props.userLogin();// console.log(props.user_info);\n},[]);var onClick=function onClick(e){var newVewport=_objectSpread(_objectSpread({},viewport),{},{latitude:e.lngLat[1],longitude:e.lngLat[0]});setPos({lng:e.lngLat[0],lat:e.lngLat[1]});console.log(isAdd);if(isAdd)setPoint(true);setViewport(newVewport);};var onDblClick=function onDblClick(e){console.log('A click event has occurred at '+e.lngLat[0]);};var PlusIcon=function PlusIcon(_ref2){var handleClick=_ref2.handleClick,value=_ref2.value;var divStyle={position:'absolute',margin:'15px 15px',zIndex:'500'};var divStyle1={position:'absolute',margin:'10px 15px',zIndex:'500',animation:'App-logo-spin 0s',animationFillMode:'forwards'};return/*#__PURE__*/React.createElement(\"div\",{style:value?divStyle1:divStyle,onClick:function onClick(){return handleClick(!value);}},/*#__PURE__*/React.createElement(\"svg\",{className:\"marker white\",style:{height:\"\".concat(3*12,\"px\"),width:\"\".concat(3*12,\"px\")},version:\"1.1\",id:\"Layer_1\",x:\"0px\",y:\"0px\",viewBox:\"0 0 512 512\"},/*#__PURE__*/React.createElement(\"g\",null,/*#__PURE__*/React.createElement(\"g\",null,/*#__PURE__*/React.createElement(\"path\",{style:{fill:'white'},d:\"m272 184c-4.417969 0-8-3.582031-8-8v-176h-80v176c0 4.417969-3.582031 8-8 8h-176v80h176c4.417969 0 8 3.582031 8 8v176h80v-176c0-4.417969 3.582031-8 8-8h176v-80zm0 0\"})))));};var Point=function Point(_ref3){var pos=_ref3.pos;return/*#__PURE__*/React.createElement(\"div\",{style:{position:'absolute',padding:'2px 7px',height:'15px',lineHeight:'15px',borderRadius:'3px',backgroundColor:'white',color:'black',top:'2%',left:'5%'}},pos.lng.toFixed(6),\" - \",pos.lat.toFixed(6));};return/*#__PURE__*/React.createElement(ReactMapGL,Object.assign({mapStyle:\"mapbox://styles/thecjreynolds/ck117fnjy0ff61cnsclwimyay\",mapboxApiAccessToken:'pk.eyJ1IjoiemF5dHNldjUiLCJhIjoiY2tjaWk4cnc2MGtiMDJxazJwMGllOThlNyJ9.HciILC1tn3zdsXCuvzdRog',onViewportChange:setViewport,doubleClickZoom:false,onDblClick:onClick,scrollZoom:isShown?false:true,onClick:function onClick(e){return onDblClick(e);}},viewport),/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(PlusIcon,{handleClick:function handleClick(val){return setAdd(val);},value:isAdd}),isAdd&&/*#__PURE__*/React.createElement(AddBox,{reload:function reload(){return getEntries();},logged:user,name:logged.displayName})),/*#__PURE__*/React.createElement(React.Fragment,null,point&&/*#__PURE__*/React.createElement(Point,{pos:pos})),/*#__PURE__*/React.createElement(Router,null),!load&&/*#__PURE__*/React.createElement(Processing,null),logEntries.map(function(entry){return/*#__PURE__*/React.createElement(React.Fragment,{key:entry.id},/*#__PURE__*/React.createElement(Marker,{latitude:entry.latitude,longitude:entry.longitude},/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return setShowPopup(entry.id);},style:{cursor:'pointer'}},/*#__PURE__*/React.createElement(\"svg\",{className:\"marker white\",style:{height:\"\".concat(3*viewport.zoom,\"px\"),width:\"\".concat(3*viewport.zoom,\"px\"),cursor:'pointer'},version:\"1.1\",id:\"Layer_1\",x:\"0px\",y:\"0px\",viewBox:\"0 0 512 512\"},/*#__PURE__*/React.createElement(\"g\",null,/*#__PURE__*/React.createElement(\"g\",null,/*#__PURE__*/React.createElement(\"path\",{style:{fill:'white'},d:\"M184.08,0c-74.992,0-136,61.008-136,136c0,24.688,11.072,51.24,11.536,52.36c3.576,8.488,10.632,21.672,15.72,29.4 l93.248,141.288c3.816,5.792,9.464,9.112,15.496,9.112s11.68-3.32,15.496-9.104l93.256-141.296 c5.096-7.728,12.144-20.912,15.72-29.4c0.464-1.112,11.528-27.664,11.528-52.36C320.08,61.008,259.072,0,184.08,0z M293.8,182.152c-3.192,7.608-9.76,19.872-14.328,26.8l-93.256,141.296c-1.84,2.792-2.424,2.792-4.264,0L88.696,208.952 c-4.568-6.928-11.136-19.2-14.328-26.808C74.232,181.816,64.08,157.376,64.08,136c0-66.168,53.832-120,120-120 c66.168,0,120,53.832,120,120C304.08,157.408,293.904,181.912,293.8,182.152z\"}),/*#__PURE__*/React.createElement(\"path\",{style:{fill:'white'},d:\"M184.08,64.008c-39.704,0-72,32.304-72,72c0,39.696,32.296,72,72,72c39.704,0,72-32.304,72-72 C256.08,96.312,223.784,64.008,184.08,64.008z M184.08,192.008c-30.872,0-56-25.12-56-56s25.128-56,56-56s56,25.12,56,56 S214.952,192.008,184.08,192.008z\"})))))),showPopup==entry.id?/*#__PURE__*/React.createElement(Popup,{className:\"mu-popup\",latitude:entry.latitude,longitude:entry.longitude,closeButton:true,closeOnClick:false,dynamicPosition:true,onClose:function onClose(){return setShowPopup({});},anchor:\"top\"},/*#__PURE__*/React.createElement(\"div\",{className:\"asdsa-apopup\",style:_defineProperty({width:'210px',fontSize:'12px',zIndex:'99',position:'relative'},\"zIndex\",'300')},/*#__PURE__*/React.createElement(\"h2\",null,entry.title),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",{style:{fontSize:'15px'}},entry.comments)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Author\"),\" - \",entry.author),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Visited on:\"),\" \",new Date(entry.visitDate).toLocaleDateString()),entry.image&&/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(Link,{to:\"/log/\".concat(entry.id)},/*#__PURE__*/React.createElement(\"p\",{onClick:function onClick(){return setShow(entry.id);}},/*#__PURE__*/React.createElement(\"img\",{src:entry.image,alt:entry.title,width:\"210px\",height:\"100px\",title:\"Zoom in\"})))),entry.image&&/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(Link,{to:\"\".concat(entry.id)})))):null,isShown==entry.id?/*#__PURE__*/React.createElement(ImageView,{src:entry.image,id:entry.id,uid:logged.id,name:logged.displayName,log:entry,offShow:function offShow(val){return setShow(val);},url:logged?logged.photos[0].value:''}):null,logged?/*#__PURE__*/React.createElement(User,{url:logged.photos[0].value,userName:logged.displayName}):/*#__PURE__*/React.createElement(\"div\",{className:\"login\"},/*#__PURE__*/React.createElement(\"a\",{href:\"http://localhost:3000/auth/facebook\",style:_defineProperty({position:'absolute',padding:'5px 10px',lineHeight:'25px',borderRadius:'3px',backgroundColor:'white',color:'black',bottom:'5%',left:'5%',textDecoration:'none'},\"color\",'#4267b2')},\"Login with facebook\")),/*#__PURE__*/React.createElement(\"div\",{onClick:function onClick(){return setHint(true);}},/*#__PURE__*/React.createElement(\"p\",{href:\"http://localhost:3000/auth/facebook\",style:_defineProperty({position:'absolute',padding:'1px 10px',lineHeight:'25px',borderRadius:'50%',backgroundColor:'white',color:'black',bottom:'3%',left:'1%',textDecoration:'none'},\"color\",'#4267b2')},\"?\")),hint&&/*#__PURE__*/React.createElement(Direction,{off:function off(val){return setHint(val);}}),/*#__PURE__*/React.createElement(Clock,null));}));};var mapStateToProps=function mapStateToProps(state){return{user_info:state.data.user,// newPost: state.data.item,\nmessage:state.data.message};};//Connect Posts to Store, pass fectPosts and delPost to Posts component\nexport default connect(mapStateToProps,{userLogin:userLogin,userLogout:userLogout})(Mapbox);","map":null,"metadata":{},"sourceType":"module"}