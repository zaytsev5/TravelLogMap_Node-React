{"ast":null,"code":"var _jsxFileName = \"/Users/apple/Documents/mapbox/src/App.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport ReactMapGL, { Marker, Popup } from 'react-map-gl';\nimport { BrowserRouter as Router, Switch, Route, Link, useParams } from \"react-router-dom\";\nimport ImageView from './components/ImageView';\nimport AddBox from './components/AddBox';\nimport User from './components/User';\nimport Processing from './components/Processing';\nimport Direction from './components/Direction';\nimport LogView from './components/LogView';\nimport Clock from './components/Clock';\n\nconst Mapbox = () => {\n  const [exp, setExp] = useState();\n  const [logEntries, setLogEntries] = useState([]);\n  const [showPopup, setShowPopup] = useState({});\n  const [isShown, setShow] = useState(0);\n  const [isAdd, setAdd] = useState(false);\n  const [point, setPoint] = useState(false);\n  const [pos, setPos] = useState({});\n  const [user, setUser] = useState(false);\n  const [load, setLoad] = useState(false);\n  const [logged, setLogged] = useState({});\n  const [hint, setHint] = useState(false); // const [exp, setExp] = useState(60000 * 5)\n  // const [addEntryLocation, setAddEntryLocation] = useState(null);\n\n  const [viewport, setViewport] = useState({\n    width: '100vw',\n    height: '100vh',\n    latitude: 10.7781128,\n    longitude: 106.65325,\n    zoom: 12\n  });\n\n  const getLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(showPosition);\n    } else {\n      alert(\"Geolocation is not supported by this browser.\");\n    }\n  };\n\n  const showPosition = position => {\n    setViewport({\n      width: '100vw',\n      height: '100vh',\n      latitude: position.coords.latitude,\n      longitude: position.coords.longitude,\n      zoom: 12\n    });\n  };\n\n  const getUser = () => {\n    console.log(\"in getUser()\");\n    fetch(\"http://localhost:3000/auth/login/success\", {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Credentials\": true\n      }\n    }).then(response => {\n      console.log(\"in then1\");\n      getEntries();\n      if (response.status === 200) return response.json();\n      throw new Error(\"failed to authenticate user\");\n    }).then(responseJson => {\n      // console.log(\"in then2\");\n      //   console.log(responseJson.expired);\n      setLogged(responseJson.user);\n      setUser(true); // console.log(\"coi thuw\");\n      // if(localStorage.getItem('expired'))\n      // setTimeout(()=>window.location = 'http://localhost:9000',localStorage.getItem('expired') - new Date().getTime());\n      // else localStorage.setItem('expired',responseJson.expired)\n      // setTimeout(()=>window.location = 'http://localhost:9000',localStorage.getItem('expired') - new Date().getTime());\n    }).catch(error => {\n      setLogged(false);\n    });\n  };\n\n  const getEntries = async () => {\n    const response = await fetch('http://localhost:3000/api/logs');\n    const result = await response.json(); // setLogEntries(result)\n\n    console.log(result);\n    setLogEntries(result);\n    setLoad(true); //setUser(result)\n  };\n\n  const getUserPosition = async () => {\n    var getPosition = function (options) {\n      return new Promise(function (resolve, reject) {\n        navigator.geolocation.getCurrentPosition(resolve, reject, options);\n      });\n    };\n\n    const position = await getPosition();\n    const logEntries = [{\n      id: 1,\n      latitude: position.coords.latitude,\n      longitude: position.coords.longitude,\n      title: 'Bach Khoa University',\n      comments: 'This is the best university of Vietnam',\n      image: ' http://localhost:5000/img2.png'\n    }];\n    setLogEntries(logEntries);\n    console.log(logEntries);\n  };\n\n  useEffect(() => {\n    if (window.location.hash === \"#_=_\") {\n      window.history.replaceState ? window.history.replaceState(null, null, window.location.href.split(\"#\")[0]) : window.location.hash = \"\";\n    } //getLocation()\n\n\n    getUser(); // getEntries()\n    // console.log(isShown);\n    //console.log(exp);\n  }, []);\n\n  const onClick = e => {\n    const newVewport = { ...viewport,\n      latitude: e.lngLat[1],\n      longitude: e.lngLat[0]\n    };\n    setPos({\n      lng: e.lngLat[0],\n      lat: e.lngLat[1]\n    });\n    console.log(isAdd);\n    if (isAdd) setPoint(true);\n    setViewport(newVewport);\n  };\n\n  const onDblClick = e => {\n    //for(let i in e.lngLat) console.log(i);\n    console.log('A click event has occurred at ' + e.lngLat[0]); // setPos({ lng: e.lngLat[0], lat: e.lngLat[1] })\n    // console.log(isAdd);\n    // if (isAdd) setPoint(true)\n  };\n\n  const PlusIcon = ({\n    handleClick,\n    value\n  }) => {\n    console.log(\"loading\");\n    const divStyle = {\n      position: 'absolute',\n      margin: '15px 15px',\n      zIndex: '500'\n    };\n    const divStyle1 = {\n      position: 'absolute',\n      margin: '10px 15px',\n      zIndex: '500',\n      animation: 'App-logo-spin 0s',\n      animationFillMode: 'forwards'\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: value ? divStyle1 : divStyle,\n      onClick: () => handleClick(!value),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"svg\", {\n      className: \"marker white\",\n      style: {\n        height: `${3 * 12}px`,\n        width: `${3 * 12}px`\n      },\n      version: \"1.1\",\n      id: \"Layer_1\",\n      x: \"0px\",\n      y: \"0px\",\n      viewBox: \"0 0 512 512\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"g\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      style: {\n        fill: 'white'\n      },\n      d: \"m272 184c-4.417969 0-8-3.582031-8-8v-176h-80v176c0 4.417969-3.582031 8-8 8h-176v80h176c4.417969 0 8 3.582031 8 8v176h80v-176c0-4.417969 3.582031-8 8-8h176v-80zm0 0\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 23\n      }\n    })))));\n  };\n\n  const Point = ({\n    pos\n  }) => {\n    //   const copy = (event) => {\n    //     alert(\"in\")\n    //     event.preventDefault();\n    //     if (event.clipboardData) {\n    //       event.clipboardData.setData(\"text/plain\", event.target.textContent);\n    //       alert(event.clipboardData.getData(\"text\"))\n    // }\n    //   }\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        padding: '2px 7px',\n        height: '15px',\n        lineHeight: '15px',\n        borderRadius: '3px',\n        backgroundColor: 'white',\n        color: 'black',\n        top: '2%',\n        left: '5%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 7\n      }\n    }, pos.lng.toFixed(6), \" - \", pos.lat.toFixed(6));\n  };\n\n  return /*#__PURE__*/React.createElement(ReactMapGL, Object.assign({\n    mapStyle: \"mapbox://styles/thecjreynolds/ck117fnjy0ff61cnsclwimyay\" // mapStyle=\"mapbox://styles/mapbox/satellite-v9\"\n    ,\n    mapboxApiAccessToken: 'pk.eyJ1IjoiemF5dHNldjUiLCJhIjoiY2tjaWk4cnc2MGtiMDJxazJwMGllOThlNyJ9.HciILC1tn3zdsXCuvzdRog',\n    onViewportChange: setViewport,\n    doubleClickZoom: false,\n    onDblClick: onClick,\n    scrollZoom: isShown ? false : true,\n    onClick: e => onDblClick(e)\n  }, viewport, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(PlusIcon, {\n    handleClick: val => setAdd(val),\n    value: isAdd,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }), isAdd && /*#__PURE__*/React.createElement(AddBox, {\n    reload: () => getEntries(),\n    logged: user,\n    name: logged.displayName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 20\n    }\n  })), /*#__PURE__*/React.createElement(React.Fragment, null, point && /*#__PURE__*/React.createElement(Point, {\n    pos: pos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 20\n    }\n  })), !load && /*#__PURE__*/React.createElement(Processing, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 18\n    }\n  }), logEntries.map(entry => /*#__PURE__*/React.createElement(React.Fragment, {\n    key: entry.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Marker, {\n    latitude: entry.latitude,\n    longitude: entry.longitude,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    // onClick = {() =>{\n    //   console.log(\"You have clicked...\");\n    // }}\n    onClick: () => setShowPopup(entry.id),\n    style: {\n      cursor: 'pointer'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    className: \"marker white\",\n    style: {\n      height: `${3 * viewport.zoom}px`,\n      width: `${3 * viewport.zoom}px`,\n      cursor: 'pointer'\n    },\n    version: \"1.1\",\n    id: \"Layer_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512 512\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    style: {\n      fill: 'white'\n    },\n    d: \"M184.08,0c-74.992,0-136,61.008-136,136c0,24.688,11.072,51.24,11.536,52.36c3.576,8.488,10.632,21.672,15.72,29.4 l93.248,141.288c3.816,5.792,9.464,9.112,15.496,9.112s11.68-3.32,15.496-9.104l93.256-141.296 c5.096-7.728,12.144-20.912,15.72-29.4c0.464-1.112,11.528-27.664,11.528-52.36C320.08,61.008,259.072,0,184.08,0z M293.8,182.152c-3.192,7.608-9.76,19.872-14.328,26.8l-93.256,141.296c-1.84,2.792-2.424,2.792-4.264,0L88.696,208.952 c-4.568-6.928-11.136-19.2-14.328-26.808C74.232,181.816,64.08,157.376,64.08,136c0-66.168,53.832-120,120-120 c66.168,0,120,53.832,120,120C304.08,157.408,293.904,181.912,293.8,182.152z\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    style: {\n      fill: 'white'\n    },\n    d: \"M184.08,64.008c-39.704,0-72,32.304-72,72c0,39.696,32.296,72,72,72c39.704,0,72-32.304,72-72 C256.08,96.312,223.784,64.008,184.08,64.008z M184.08,192.008c-30.872,0-56-25.12-56-56s25.128-56,56-56s56,25.12,56,56 S214.952,192.008,184.08,192.008z\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 21\n    }\n  })))))), showPopup == entry.id ? /*#__PURE__*/React.createElement(Popup, {\n    className: \"mu-popup\",\n    latitude: entry.latitude,\n    longitude: entry.longitude,\n    closeButton: true,\n    closeOnClick: false,\n    dynamicPosition: true,\n    onClose: () => setShowPopup({}),\n    anchor: \"top\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"popup\",\n    style: {\n      width: '210px',\n      fontSize: '12px',\n      zIndex: '99',\n      position: 'relative',\n      zIndex: '300'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 21\n    }\n  }, entry.title), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    style: {\n      fontSize: '15px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 24\n    }\n  }, entry.comments)), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 24\n    }\n  }, \"Author\"), \" - \", entry.author), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 24\n    }\n  }, \"Visited on:\"), \" \", new Date(entry.visitDate).toLocaleDateString()), entry.image && /*#__PURE__*/React.createElement(Router, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: `/log/${entry.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    onClick: () => setShow(entry.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: entry.image,\n    alt: entry.title,\n    width: \"210px\",\n    height: \"100px\",\n    title: \"Zoom in\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 64\n    }\n  })))), entry.image && /*#__PURE__*/React.createElement(Router, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: `${entry.id}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      position: 'absolute',\n      padding: '2px 7px',\n      height: '15px',\n      lineHeight: '15px',\n      borderRadius: '3px',\n      backgroundColor: 'white',\n      color: 'black',\n      bottom: '0%',\n      left: '2%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 25\n    }\n  }, \"Click image to view more\"))))) : null, // you can use Link instead of ..\n  isShown == entry.id ? /*#__PURE__*/React.createElement(ImageView, {\n    src: entry.image,\n    id: entry.id,\n    uid: logged.id,\n    name: logged.displayName,\n    log: entry,\n    offShow: val => setShow(val),\n    url: logged ? logged.photos[0].value : '',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 15\n    }\n  }) : null, logged ? /*#__PURE__*/React.createElement(User, {\n    url: logged.photos[0].value,\n    userName: logged.displayName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 24\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: \"http://localhost:3000/auth/facebook\",\n    style: {\n      position: 'absolute',\n      padding: '5px 10px',\n      // height:'25px',\n      lineHeight: '25px',\n      borderRadius: '3px',\n      backgroundColor: 'white',\n      color: 'black',\n      bottom: '5%',\n      left: '5%',\n      textDecoration: 'none',\n      color: '#4267b2'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 17\n    }\n  }, \"Login with facebook\")), /*#__PURE__*/React.createElement(\"div\", {\n    onClick: () => setHint(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    href: \"http://localhost:3000/auth/facebook\",\n    style: {\n      position: 'absolute',\n      padding: '1px 10px',\n      // height:'25px',\n      lineHeight: '25px',\n      borderRadius: '50%',\n      backgroundColor: 'white',\n      color: 'black',\n      bottom: '3%',\n      left: '1%',\n      textDecoration: 'none',\n      color: '#4267b2'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"../public/newlogo.png\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 431,\n      columnNumber: 19\n    }\n  }))), hint && /*#__PURE__*/React.createElement(Direction, {\n    off: val => setHint(val),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 435,\n      columnNumber: 24\n    }\n  }), /*#__PURE__*/React.createElement(Clock, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 15\n    }\n  }))));\n};\n\nexport default Mapbox;","map":{"version":3,"sources":["/Users/apple/Documents/mapbox/src/App.js"],"names":["React","useState","useEffect","useRef","ReactMapGL","Marker","Popup","BrowserRouter","Router","Switch","Route","Link","useParams","ImageView","AddBox","User","Processing","Direction","LogView","Clock","Mapbox","exp","setExp","logEntries","setLogEntries","showPopup","setShowPopup","isShown","setShow","isAdd","setAdd","point","setPoint","pos","setPos","user","setUser","load","setLoad","logged","setLogged","hint","setHint","viewport","setViewport","width","height","latitude","longitude","zoom","getLocation","navigator","geolocation","getCurrentPosition","showPosition","alert","position","coords","getUser","console","log","fetch","method","credentials","headers","Accept","then","response","getEntries","status","json","Error","responseJson","catch","error","result","getUserPosition","getPosition","options","Promise","resolve","reject","id","title","comments","image","window","location","hash","history","replaceState","href","split","onClick","e","newVewport","lngLat","lng","lat","onDblClick","PlusIcon","handleClick","value","divStyle","margin","zIndex","divStyle1","animation","animationFillMode","fill","Point","padding","lineHeight","borderRadius","backgroundColor","color","top","left","toFixed","val","displayName","map","entry","cursor","fontSize","author","Date","visitDate","toLocaleDateString","bottom","photos","textDecoration"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport ReactMapGL, { Marker, Popup} from 'react-map-gl';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n  useParams\n} from \"react-router-dom\";\nimport ImageView from './components/ImageView';\nimport AddBox from './components/AddBox'\nimport User from './components/User'\nimport Processing from './components/Processing'\nimport Direction from './components/Direction'\nimport LogView from './components/LogView'\nimport Clock from './components/Clock'\n\n\n\n\n\nconst Mapbox = () => {\n  const [exp, setExp] = useState()\n  const [logEntries, setLogEntries] = useState([]);\n  const [showPopup, setShowPopup] = useState({});\n  const [isShown , setShow] = useState(0)\n  const [isAdd, setAdd] = useState(false)\n  const [point, setPoint] = useState(false)\n  const [pos, setPos] = useState({})\n  const [user, setUser] = useState(false)\n  const [load, setLoad] = useState(false)\n  const [logged, setLogged] = useState({})\n  const [hint, setHint] = useState(false)\n // const [exp, setExp] = useState(60000 * 5)\n  \n\n  \n  \n  // const [addEntryLocation, setAddEntryLocation] = useState(null);\n\n  const [viewport, setViewport] = useState({\n    width: '100vw',\n    height: '100vh',\n    latitude: 10.7781128,\n    longitude: 106.65325,\n    zoom: 12\n  });\n\n  const getLocation = ()=>{\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(showPosition);\n    } else { \n      alert(\"Geolocation is not supported by this browser.\")\n    }\n  }\n  \n  const showPosition = (position) => {\n    setViewport({\n      width: '100vw',\n      height: '100vh',\n      latitude: position.coords.latitude,\n      longitude: position.coords.longitude,\n      zoom:12\n    })\n  }\n\n  const getUser = () => {\n    console.log(\"in getUser()\");\n    fetch(\"http://localhost:3000/auth/login/success\", {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Credentials\": true\n      }\n    })\n      .then(response => {\n      console.log(\"in then1\");\n\n        getEntries()\n        if (response.status === 200) return response.json();\n        throw new Error(\"failed to authenticate user\");\n      })\n      .then(responseJson => {\n      // console.log(\"in then2\");\n      //   console.log(responseJson.expired);\n        setLogged(responseJson.user)\n        setUser(true)\n        // console.log(\"coi thuw\");\n        // if(localStorage.getItem('expired'))\n        // setTimeout(()=>window.location = 'http://localhost:9000',localStorage.getItem('expired') - new Date().getTime());\n\n        // else localStorage.setItem('expired',responseJson.expired)\n\n        // setTimeout(()=>window.location = 'http://localhost:9000',localStorage.getItem('expired') - new Date().getTime());\n      })\n      .catch(error => {\n        setLogged(false)\n\n      });\n      \n  }\n  \n  const getEntries = async () => {\n    const response = await fetch('http://localhost:3000/api/logs')\n    const result = await response.json()\n    // setLogEntries(result)\n    console.log(result);\n    setLogEntries(result);\n    setLoad(true)\n    //setUser(result)\n    \n  };\n  \n\n  const getUserPosition = async() =>{\n    var getPosition = function (options) {\n      return new Promise(function (resolve, reject) {\n        navigator.geolocation.getCurrentPosition(resolve, reject, options);\n      });\n    }\n    const position = await getPosition();\n    const logEntries = [\n      {\n        id:1,\n        latitude:position.coords.latitude,\n        longitude:position.coords.longitude,\n        title: 'Bach Khoa University',\n        comments: 'This is the best university of Vietnam',\n        image: ' http://localhost:5000/img2.png'\n      }\n    ]\n    setLogEntries(logEntries);\n    console.log(logEntries);\n  }\n \n\n\n  useEffect( () => {\n    if (window.location.hash === \"#_=_\"){\n      window.history.replaceState \n          ? window.history.replaceState(null, null, window.location.href.split(\"#\")[0])\n          : window.location.hash = \"\";\n    }\n    //getLocation()\n   \n    getUser()\n    // getEntries()\n   // console.log(isShown);\n    //console.log(exp);\n  }, []);\n\n  const onClick = (e) => {\n    const newVewport = {\n      ...viewport,\n      latitude: e.lngLat[1],\n      longitude: e.lngLat[0]\n    };\n    setPos({ lng: e.lngLat[0], lat: e.lngLat[1] })\n    console.log(isAdd);\n    if (isAdd) setPoint(true)\n  \n    setViewport(newVewport);\n  };\n  \n  const onDblClick = e => {\n    //for(let i in e.lngLat) console.log(i);\n    console.log('A click event has occurred at ' + e.lngLat[0]);\n    // setPos({ lng: e.lngLat[0], lat: e.lngLat[1] })\n    // console.log(isAdd);\n    // if (isAdd) setPoint(true)\n\n  };\n\n  const PlusIcon = ({handleClick,value}) =>{\n    console.log(\"loading\");\n    const divStyle  = {\n      position:'absolute',\n      margin:'15px 15px',\n      zIndex:'500',\n     \n    }\n    const divStyle1  = {\n      position:'absolute',\n      margin:'10px 15px',\n      zIndex:'500',\n      animation:'App-logo-spin 0s',\n      animationFillMode: 'forwards',\n      \n\n    }\n    return (\n      <div style={value ? divStyle1 : divStyle} onClick={()=>handleClick(!value)}> \n        <svg\n                  className=\"marker white\"\n                  style={{\n                    height: `${3 * 12}px`,\n                    width: `${3 * 12}px`,\n                  }}\n                  version=\"1.1\" id=\"Layer_1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 512 512\">\n                  <g>\n                    <g>\n                      <path style={{fill:'white'}} d=\"m272 184c-4.417969 0-8-3.582031-8-8v-176h-80v176c0 4.417969-3.582031 8-8 8h-176v80h176c4.417969 0 8 3.582031 8 8v176h80v-176c0-4.417969 3.582031-8 8-8h176v-80zm0 0\"/>\n                    </g>\n                  </g>\n                </svg>\n      </div>\n    )\n  }\n  const Point = ({pos}) =>{\n  //   const copy = (event) => {\n  //     alert(\"in\")\n  //     event.preventDefault();\n  //     if (event.clipboardData) {\n  //       event.clipboardData.setData(\"text/plain\", event.target.textContent);\n  //       alert(event.clipboardData.getData(\"text\"))\n  // }\n  //   }\n    return (\n      <div \n        style={{\n          position: 'absolute',\n          padding: '2px 7px',\n          height: '15px',\n          lineHeight: '15px',\n          borderRadius: '3px',\n          backgroundColor: 'white',\n          color: 'black',\n          top: '2%',\n          left: '5%',\n\n        }}>\n      \n       {pos.lng.toFixed(6)} - {pos.lat.toFixed(6)}\n      </div>\n    )\n  }\n \n  return (  \n    <ReactMapGL\n  \n      mapStyle=\"mapbox://styles/thecjreynolds/ck117fnjy0ff61cnsclwimyay\"\n      // mapStyle=\"mapbox://styles/mapbox/satellite-v9\"\n      mapboxApiAccessToken={'pk.eyJ1IjoiemF5dHNldjUiLCJhIjoiY2tjaWk4cnc2MGtiMDJxazJwMGllOThlNyJ9.HciILC1tn3zdsXCuvzdRog'}\n      onViewportChange={setViewport}\n      doubleClickZoom={false}\n      onDblClick={onClick}\n      scrollZoom={isShown ? false : true}\n      onClick={(e) => onDblClick(e)}\n      {...viewport}\n      \n    //   style={isAdd ? {\n    //     pointerEvents:'none'\n    //   } : {}\n    // }\n      \n    >\n      \n      {/* <Direction/> */}\n      <>\n        <PlusIcon handleClick={(val) => setAdd(val)} value={isAdd} />\n        {\n          isAdd && <AddBox reload={()=>getEntries()} logged={user} name={logged.displayName}/>\n        }\n\n      </>\n      <>\n        {\n          point && <Point pos={pos} />\n        }\n      </>\n      {/* <Router>\n        <Switch>\n          <Route path=\"/log/:id\" >\n            <LogView key={logged.id} userName={logged.displayName} />\n          </Route>\n        </Switch>\n      </Router> */}\n      {\n        !load && <Processing />\n      }\n      {\n        logEntries.map(entry => (\n          <React.Fragment key={entry.id}>\n            <Marker\n              latitude={entry.latitude}\n              longitude={entry.longitude}\n            >\n              <div\n                // onClick = {() =>{\n                //   console.log(\"You have clicked...\");\n                // }}\n                onClick={() => setShowPopup(entry.id)}\n                style={{\n                  \n                  cursor:'pointer'\n                }}\n              >\n                <svg\n                  className=\"marker white\"\n                  style={{\n                    height: `${3 * viewport.zoom}px`,\n                    width: `${3 * viewport.zoom}px`,\n                    cursor: 'pointer'\n                  }}\n                  version=\"1.1\" id=\"Layer_1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 512 512\">\n                  <g>\n                    <g>\n                    <path style={{fill:'white'}} d=\"M184.08,0c-74.992,0-136,61.008-136,136c0,24.688,11.072,51.24,11.536,52.36c3.576,8.488,10.632,21.672,15.72,29.4\n                        l93.248,141.288c3.816,5.792,9.464,9.112,15.496,9.112s11.68-3.32,15.496-9.104l93.256-141.296\n                        c5.096-7.728,12.144-20.912,15.72-29.4c0.464-1.112,11.528-27.664,11.528-52.36C320.08,61.008,259.072,0,184.08,0z\n                        M293.8,182.152c-3.192,7.608-9.76,19.872-14.328,26.8l-93.256,141.296c-1.84,2.792-2.424,2.792-4.264,0L88.696,208.952\n                        c-4.568-6.928-11.136-19.2-14.328-26.808C74.232,181.816,64.08,157.376,64.08,136c0-66.168,53.832-120,120-120\n                        c66.168,0,120,53.832,120,120C304.08,157.408,293.904,181.912,293.8,182.152z\"/>\n                    <path style={{fill:'white'}} d=\"M184.08,64.008c-39.704,0-72,32.304-72,72c0,39.696,32.296,72,72,72c39.704,0,72-32.304,72-72\n                        C256.08,96.312,223.784,64.008,184.08,64.008z M184.08,192.008c-30.872,0-56-25.12-56-56s25.128-56,56-56s56,25.12,56,56\n                        S214.952,192.008,184.08,192.008z\"/>\n                    </g>\n                  </g>\n                </svg>\n              </div>\n            </Marker>\n            {\n              showPopup == entry.id ? (\n                <Popup\n                  className=\"mu-popup\"\n                  latitude={entry.latitude}\n                  longitude={entry.longitude}\n                  closeButton={true}\n                  closeOnClick={false}\n                  dynamicPosition={true}\n                  onClose={() => setShowPopup({})}\n                  anchor=\"top\" >\n                  <div className=\"popup\" style={{ width: '210px', fontSize: '12px', zIndex: '99', position: 'relative', zIndex: '300' }}>\n                    <h2>{entry.title}</h2>\n                    <p><strong style={{fontSize:'15px'}}>{entry.comments}</strong></p>\n                    <p><strong>Author</strong> - {entry.author}</p>\n                    <p><strong>Visited on:</strong> {new Date(entry.visitDate).toLocaleDateString()}</p>\n                    {\n                      entry.image &&\n                      <Router>\n                        <Link to={`/log/${entry.id}`}>\n\n                          <p onClick={() => setShow(entry.id)}><img\n                            src={entry.image}\n                            alt={entry.title}\n                            width='210px' height='100px'\n                            title=\"Zoom in\"\n                          />\n                          </p>\n                        </Link>\n                      </Router>\n                    }\n                    {entry.image && \n                      <Router>\n                        <Link to={`${entry.id}`}>\n                        <p\n                          style={{\n                            position: 'absolute',\n                            padding: '2px 7px',\n                            height: '15px',\n                            lineHeight: '15px',\n                            borderRadius: '3px',\n                            backgroundColor: 'white',\n                            color: 'black',\n                            bottom: '0%',\n                            left: '2%',\n\n                          }}\n                        >Click image to view more</p>\n                        </Link>\n                      </Router>\n                      \n                    }\n                  </div>\n                </Popup>\n              ) : null\n            }\n            {// you can use Link instead of ..\n              isShown == entry.id ? (\n              <ImageView \n                src={entry.image} \n                id={entry.id} \n                uid={logged.id} \n                name={logged.displayName}\n                log={entry} \n                offShow={(val) => setShow(val)}\n                url={logged ? logged.photos[0].value : ''} />\n              ) : null\n            }\n            { logged ? <User url={logged.photos[0].value} userName={logged.displayName}/> : \n              <div className=\"login\">\n                < a \n                  href='http://localhost:3000/auth/facebook'\n                  style={{\n                    position: 'absolute',\n                    padding: '5px 10px',\n                    // height:'25px',\n                    lineHeight: '25px',\n                    borderRadius: '3px',\n                    backgroundColor: 'white',\n                    color: 'black',\n                    bottom: '5%',\n                    left: '5%',\n                    textDecoration:'none',\n                    color:'#4267b2'\n\n                  }}\n                >Login with facebook</a>\n              </div>\n            }\n            <div onClick={()=>setHint(true)} >\n                <p \n                  href='http://localhost:3000/auth/facebook'\n                  style={{\n                    position: 'absolute',\n                    padding: '1px 10px',\n                    // height:'25px',\n                    lineHeight: '25px',\n                    borderRadius: '50%',\n                    backgroundColor: 'white',\n                    color: 'black',\n                    bottom: '3%',\n                    left: '1%',\n                    textDecoration:'none',\n                    color:'#4267b2'\n\n                  }}\n                >\n                  <img src=\"../public/newlogo.png\">\n                  </img>\n                </p>\n              </div>\n              {hint && <Direction off={(val)=>setHint(val)}/>}\n              <Clock />\n          </React.Fragment>\n        ))\n      }\n     \n    </ReactMapGL>\n    \n  );\n}\n\nexport default Mapbox;"]},"metadata":{},"sourceType":"module"}